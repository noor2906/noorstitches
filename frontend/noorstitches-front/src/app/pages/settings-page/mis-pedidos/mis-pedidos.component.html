<div class="row">
  <div class="col-12">
    <!-- Filtros de pedidos -->
    <div class="mb-4">
      <div class="card-body p-3">
        <div class="row g-3 align-items-center">
          <div class="col-md-4">
            <select
              class="form-select border-morado-intermedio-1"
              (change)="filtrarPorEstado($event)"
            >
              <option value="todos" selected>Todos los pedidos</option>
              @for (estado of estadosPedidos(); track estado) {
              <option [value]="estado[1]">{{ estado[0] }}</option>
              }
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- Lista de pedidos -->
    <div class="row g-4">
      @if (pedidosUserFiltrados()!.length === 0) {
      <div class="col-12 text-center mt-5">
        <p class="text-muted mt-3 fs-5">No tienes pedidos en este estado.</p>
      </div>
      } @else { @for (pedido of pedidosUserFiltrados(); track pedido.id) {
      <div class="col-12">
        <div class="card border-morado-intermedio-1 rounded-4">
          <div class="card-body p-4">
            <div class="row align-items-top">
              <div class="col-md-2">
                <div class="py-2">
                  <h5 class="text-morado-oscuro bold mb-1">
                    Pedido #{{ pedido.id }}
                  </h5>
                  <small class="text-morado-oscuro">{{
                    pedido.fecha | date : "dd/MM/yyyy"
                  }}</small>
                </div>
              </div>

              <div class="col-md-6">
                <div class="d-flex flex-column gap-2">
                  @for (linea of lineasPorPedido().get(pedido.id!); track
                  linea.id) {
                  <div class="d-flex align-items-center">
                    <div
                      class="bg-morado-claro rounded me-3"
                      style="width: 60px; height: 60px; overflow: hidden"
                    >
                      <img
                        [src]="linea.productoDTO.urlImagen"
                        alt="Producto"
                        class="img-fluid w-100 h-100 object-fit-cover"
                      />
                    </div>

                    <div>
                      <h6 class="text-morado-oscuro bold mb-1">
                        {{ linea.productoDTO.nombre }}
                      </h6>
                      <p class="text-morado-oscuro small mb-0">
                        {{ linea.cantidad }} producto{{
                          linea.cantidad! > 1 ? "s" : ""
                        }}
                        â€¢
                        {{
                          (linea.productoDTO?.precio ?? 0) * linea.cantidad!
                            | precioEuro
                        }}
                      </p>
                    </div>
                  </div>

                  }
                </div>
              </div>

              <div class="col-md-2">
                <h5 class="text-morado-oscuro bold mb-1">
                  {{ pedido.importe! | precioEuro }}
                </h5>
              </div>

              @if (pedido.estado === "completado") {
              <div class="col-md-2 text-center">
                <span class="badge bg-verde text-blanco rounded-pill px-3 py-2">
                  Completado
                </span>
              </div>
              } @else if (pedido.estado === "cancelado") {
              <div class="col-md-2 text-center">
                <span class="badge bg-rojo text-blanco rounded-pill px-3 py-2">
                  Cancelado
                </span>
              </div>
              } @else if (pedido.estado === "pendiente") {
              <div class="col-md-2 text-center">
                <span
                  class="badge bg-morado-intermedio-1 text-blanco rounded-pill px-3 py-2"
                >
                  Pendiente
                </span>
              </div>
              }
            </div>
          </div>
        </div>
      </div>
      } }
    </div>
  </div>
</div>
